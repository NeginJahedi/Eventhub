- name: Build Docker Compose
  run: docker compose -f docker-compose.dev.yml build

- name: Start services in detached mode
  run: docker compose -f docker-compose.dev.yml up -d db redis

- name: Wait for Postgres
  run: |
    until docker compose -f docker-compose.dev.yml exec db pg_isready -U postgres; do
      sleep 2
    done

- name: Run tests inside web container
  run: docker compose -f docker-compose.dev.yml run --rm web pytest -q --disable-warnings
